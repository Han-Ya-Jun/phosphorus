'use strict'

let resChecker = [
    {
        "keyPlaceholder": "Key",
        "valuePlaceholder": "Value",
        "checked": true,
        "key": "code",
        "value": [],
        "keyDataList": "",
        "valueDataList": "",
        "valueType": "number",
        "typeChangeable": false,
        "readonly": true,
        "index": "0"
    },
    {
        "keyPlaceholder": "Key",
        "valuePlaceholder": "Value",
        "checked": true,
        "key": "msg",
        "value": [],
        "keyDataList": "",
        "valueDataList": "",
        "valueType": "string",
        "typeChangeable": false,
        "readonly": true,
        "index": "1"
    },
    {
        "keyPlaceholder": "Key",
        "valuePlaceholder": "Value",
        "checked": true,
        "key": "result",
        "value": [
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "creatorId",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "number",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.0"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "creatorName",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "string",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.1"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "fromUsrGroup",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "string",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.2"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "id",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "number",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.3"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "name",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "string",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.4"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "type",
                "value": [],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "number",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.5"
            },
            {
                "keyPlaceholder": "Key",
                "valuePlaceholder": "Value",
                "checked": true,
                "key": "projects",
                "value": [
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "creatorId",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "number",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.0"
                    },
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "creatorName",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "string",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.1"
                    },
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "id",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "number",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.2"
                    },
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "name",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "string",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.3"
                    },
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "qbsId",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "number",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.4"
                    },
                    {
                        "keyPlaceholder": "Key",
                        "valuePlaceholder": "Value",
                        "checked": true,
                        "key": "type",
                        "value": [],
                        "keyDataList": "",
                        "valueDataList": "",
                        "valueType": "number",
                        "typeChangeable": false,
                        "readonly": true,
                        "index": "2.6.5"
                    }
                ],
                "keyDataList": "",
                "valueDataList": "",
                "valueType": "array",
                "typeChangeable": false,
                "readonly": true,
                "index": "2.6"
            }
        ],
        "keyDataList": "",
        "valueDataList": "",
        "valueType": "array",
        "typeChangeable": false,
        "readonly": true,
        "index": "2"
    }
]

let resData = {
    "code": 200,
    "msg": "成功",
    "result": [
        {
            "id": 10524,
            "name": "云商服",
            "creatorId": 10002,
            "type": 0,
            "fromUsrGroup": "0",
            "creatorName": "方波",
            "projects": [
                {
                    "id": 10834,
                    "name": "外包系统",
                    "type": 0,
                    "creatorId": 10002,
                    "creatorName": "方波",
                    "qbsId": 0
                },
                {
                    "id": 10680,
                    "name": "客服系统",
                    "type": 0,
                    "creatorId": 10002,
                    "creatorName": "方波",
                    "qbsId": 0
                },
                {
                    "id": 10681,
                    "name": "管理系统",
                    "type": 0,
                    "creatorId": 10002,
                    "creatorName": "方波",
                    "qbsId": 0
                },
                {
                    "id": 10731,
                    "name": "访客系统",
                    "type": 0,
                    "creatorId": 10002,
                    "creatorName": "方波",
                    "qbsId": 0
                },
                {
                    "id": 10954,
                    "name": "运维后台系统",
                    "type": 0,
                    "creatorId": 10012,
                    "creatorName": "谢晋",
                    "qbsId": 0
                },
                {
                    "id": 10679,
                    "name": "公共资源库",
                    "type": 1,
                    "creatorId": 10002,
                    "creatorName": "方波",
                    "qbsId": 0
                }
            ]
        },
        {
            "id": 10598,
            "name": "NEW",
            "creatorId": 10391,
            "type": 0,
            "fromUsrGroup": "0",
            "creatorName": "黎浩梁",
            "projects": [
                {
                    "id": 10870,
                    "name": "5555",
                    "type": 0,
                    "creatorId": 10382,
                    "creatorName": "包勇明",
                    "qbsId": 0
                },
                {
                    "id": 10791,
                    "name": "9999",
                    "type": 0,
                    "creatorId": 10391,
                    "creatorName": "黎浩梁",
                    "qbsId": 0
                },
                {
                    "id": 10792,
                    "name": "JIRA6_REST_API",
                    "type": 0,
                    "creatorId": 10391,
                    "creatorName": "黎浩梁",
                    "qbsId": 168
                },
                {
                    "id": 10790,
                    "name": "公共资源库",
                    "type": 1,
                    "creatorId": 10391,
                    "creatorName": "黎浩梁",
                    "qbsId": 0
                }
            ]
        },
        {
            "id": 10338,
            "name": "跨境电商",
            "creatorId": 10001,
            "type": 0,
            "fromUsrGroup": "0",
            "creatorName": "俞棋军",
            "projects": [
                {
                    "id": 10364,
                    "name": "海淘mobile api",
                    "type": 0,
                    "creatorId": 10001,
                    "creatorName": "俞棋军",
                    "qbsId": 0
                },
                {
                    "id": 10354,
                    "name": "海淘ms",
                    "type": 0,
                    "creatorId": 10001,
                    "creatorName": "俞棋军",
                    "qbsId": 0
                },
                {
                    "id": 10355,
                    "name": "海淘online",
                    "type": 0,
                    "creatorId": 10001,
                    "creatorName": "俞棋军",
                    "qbsId": 0
                },
                {
                    "id": 10361,
                    "name": "海淘wap",
                    "type": 0,
                    "creatorId": 10001,
                    "creatorName": "俞棋军",
                    "qbsId": 0
                },
                {
                    "id": 10453,
                    "name": "公共资源库",
                    "type": 1,
                    "creatorId": 10001,
                    "creatorName": "俞棋军",
                    "qbsId": 0
                }
            ]
        },
        {
            "id": 10591,
            "name": "tst",
            "creatorId": 10382,
            "type": 0,
            "fromUsrGroup": "0",
            "creatorName": "包勇明",
            "projects": [
                {
                    "id": 10835,
                    "name": "5555",
                    "type": 0,
                    "creatorId": 10382,
                    "creatorName": "包勇明",
                    "qbsId": 0
                },
                {
                    "id": 10781,
                    "name": "公共资源库",
                    "type": 1,
                    "creatorId": 10382,
                    "creatorName": "包勇明",
                    "qbsId": 0
                }
            ]
        },
        {
            "id": 10447,
            "name": "默认分组",
            "creatorId": 10382,
            "type": 1,
            "fromUsrGroup": "0",
            "creatorName": "包勇明",
            "projects": [
                {
                    "id": 10588,
                    "name": "公共资源库",
                    "type": 1,
                    "creatorId": 10382,
                    "creatorName": "包勇明",
                    "qbsId": 0
                }
            ]
        }
    ]
}

let checkResponseResult = () => {
    if (resChecker.length === 0) {
        return false
    }
    if (typeof resData !== 'object' || Array.isArray(resData)) {
        return false
    }
    let checkData = (checker, data) => {
        for (let i = 0, l = checker.length; i < l; i++) {
            let rc = checker[i]
            let key = rc.key
            if (data.hasOwnProperty(key)) {
                let resultKeyType = Array.isArray(data[key]) ? 'array' : typeof data[key]
                if (resultKeyType === rc.valueType) {
                    if (resultKeyType === 'array') {
                        for (let j = 0, m = data[key].length; j < m; j++) {
                            let tempResult = checkData(rc.value, data[key][j])
                            if (tempResult) {
                                return tempResult
                            }
                        }
                    } else if (resultKeyType === 'object') {
                        let tempResult = checkData(rc.value, data[key])
                        if (tempResult) {
                            return tempResult
                        }
                    }
                } else {
                    return {
                        status: 'failed',
                        info: `Field "${key}"'s type should be "${rc.valueType}", but it is "${resultKeyType}"`
                    }
                }
            } else {
                return {
                    status: 'failed',
                    info: `No such field: ${key}`
                }
            }
        }
    }
    // if check success, checkData is return `undefined`
    let checkResult = checkData(resChecker, resData)
    return checkResult || true
}

console.log(checkResponseResult())
